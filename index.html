<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEAP Tarsier | Ecosystem</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Plus+Jakarta+Sans:wght@300;500;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@metaplex-foundation/umi-bundle-defaults@latest/dist/browser/index.iife.min.js"></script>
    <script src="https://unpkg.com/@metaplex-foundation/mpl-candy-machine@latest/dist/browser/index.iife.min.js"></script>

    <style>
        /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶¨ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® CSS ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶π‡ßÅ‡¶¨‡¶π‡ßÅ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
        :root { --primary: #9945FF; --secondary: #14F195; --dark: #000; --glass: rgba(15, 15, 15, 0.98); --border: rgba(255, 255, 255, 0.15); }
        body { background: var(--dark); color: white; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; }
        #proCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.6; }
        nav { display: flex; justify-content: space-between; padding: 15px 4%; background: rgba(0,0,0,0.9); border-bottom: 1px solid var(--border); }
        .mint-container { max-width: 900px; margin: 50px auto; background: var(--glass); border: 2px solid var(--border); border-radius: 24px; display: grid; grid-template-columns: 1fr 1.2fr; overflow: hidden; }
        .mint-info { padding: 40px; }
        .mint-btn { width: 100%; padding: 15px; background: linear-gradient(90deg, var(--secondary), #00d1d1); border: none; border-radius: 10px; font-family: Orbitron; font-weight: 900; cursor: pointer; }
        .nav-buy-btn { background: var(--primary); padding: 8px 18px; border-radius: 8px; color: white; text-decoration: none; font-size: 0.8rem; }
    </style>
</head>
<body>

<canvas id="proCanvas"></canvas>

<div class="wrapper">
    <nav>
        <div style="font-family: Orbitron; font-weight: 900;">LEAP <span style="color: var(--secondary);">TARSIER</span></div>
        <a href="#" class="nav-buy-btn">BUY TOKEN</a>
    </nav>

    <div id="nft-section" class="mint-container">
        <div style="padding: 30px;"><img src="nft.jpg" style="width: 100%; border-radius: 15px; border: 1px solid var(--primary);"></div>
        <div class="mint-info">
            <h3 style="font-family: Orbitron; color: var(--secondary);">MINT YOUR TARSIER</h3>
            <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <span>PRICE: 0.05 SOL</span>
                    <span id="mintCount">-- / 1000</span>
                </div>
                <button id="mintButton" class="mint-btn" onclick="startProcess()">CONNECT WALLET</button>
                <p id="statusMsg" style="text-align: center; font-size: 0.7rem; margin-top: 10px; color: #888;"></p>
            </div>
        </div>
    </div>
</div>

<script>
    // --- ‡ßß. BG ANIMATION (‡¶∏‡¶¨ ‡¶∏‡¶Æ‡ßü ‡¶ö‡¶≤‡¶¨‡ßá) ---
    const canvas = document.getElementById('proCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; init(); }
    function init() { particles = []; for(let i=0; i<80; i++) particles.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, vx:Math.random()-0.5, vy:Math.random()-0.5}); }
    function animate() {
        ctx.clearRect(0,0,canvas.width, canvas.height);
        particles.forEach(p => {
            p.x+=p.vx; p.y+=p.vy;
            if(p.x<0 || p.x>canvas.width) p.vx*=-1; if(p.y<0 || p.y>canvas.height) p.vy*=-1;
            ctx.fillStyle = '#9945FF'; ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
        });
        requestAnimationFrame(animate);
    }
    window.addEventListener('resize', resize);
    resize(); animate();

    // --- ‡ß®. MINTING SYSTEM ---
    const CM_ID = "6Eqhz5ZC1ENXTfBDgkSEyyC6DTASvXz8DR7iNRQwxf8N";
    
    // Umi Setup
    const { createUmi } = window['@metaplex-foundation/umi-bundle-defaults'];
    const { mplCandyMachine, fetchCandyMachine, mintV2 } = window['@metaplex-foundation/mpl-candy-machine'];
    const { publicKey, generateSigner, createNoopSigner, signerIdentity } = window['@metaplex-foundation/umi'];

    const umi = createUmi('https://api.devnet.solana.com').use(mplCandyMachine());

    async function startProcess() {
        const btn = document.getElementById('mintButton');
        const status = document.getElementById('statusMsg');

        // ‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ ‡¶ö‡ßá‡¶ï
        if (!window.solana || !window.solana.isPhantom) {
            alert("Please install Phantom Wallet!");
            window.open("https://phantom.app/", "_blank");
            return;
        }

        try {
            // ‡ßß. ‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü
            const wallet = await window.solana.connect();
            const walletPubKey = wallet.publicKey.toString();
            status.innerText = "Wallet: " + walletPubKey.substring(0,6) + "...";
            
            if(btn.innerText === "CONNECT WALLET") {
                btn.innerText = "MINT NOW";
                return;
            }

            // ‡ß®. ‡¶Æ‡¶ø‡¶®‡ßç‡¶ü‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ
            btn.disabled = true;
            btn.innerText = "WAITING FOR APPROVAL...";

            // Umi-‡¶§‡ßá ‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶è‡¶á ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶ü‡¶ø‡¶á ‡¶Ü‡¶ó‡ßá ‡¶≠‡ßÅ‡¶≤ ‡¶π‡¶ö‡ßç‡¶õ‡¶ø‡¶≤)
            const walletSigner = {
                publicKey: publicKey(walletPubKey),
                async signTransaction(tx) { return await window.solana.signTransaction(tx); },
                async signAllTransactions(txs) { return await window.solana.signAllTransactions(txs); },
                async signMessage(msg) { return await window.solana.signMessage(msg); }
            };
            umi.use(signerIdentity(walletSigner));

            // ‡ß©. ‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶ø ‡¶Æ‡ßá‡¶∂‡¶ø‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ
            const candyMachine = await fetchCandyMachine(umi, publicKey(CM_ID));
            const nftMint = generateSigner(umi);

            const result = await mintV2(umi, {
                candyMachine: candyMachine.publicKey,
                nftMint: nftMint,
                collectionMint: candyMachine.collectionMint,
                collectionUpdateAuthority: candyMachine.authority,
            }).sendAndConfirm(umi);

            alert("CONGRATULATIONS! NFT Minted Success! üéâ");
            btn.innerText = "MINT ANOTHER";

        } catch (err) {
            console.error(err);
            alert("Error: " + err.message);
            btn.innerText = "TRY AGAIN";
        } finally {
            btn.disabled = false;
        }
    }

    // ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶á ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤ ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶≠‡¶æ‡¶≤‡ßã)
    async function updateStats() {
        try {
            const cm = await fetchCandyMachine(umi, publicKey(CM_ID));
            document.getElementById('mintCount').innerText = `${cm.itemsRedeemed} / ${cm.data.itemsAvailable}`;
        } catch(e) {}
    }
    updateStats();
</script>

</body>
</html>
